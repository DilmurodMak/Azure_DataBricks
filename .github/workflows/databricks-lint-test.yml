name: "CI Linting"

on:
  pull_request:
    branches:
      - main
      
env:
  UV_VERSION: ">=0.4.26"
  PYTHON_VERSION: "3.11"

jobs:
  linting:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout the repository
        uses: actions/checkout@v4

      - name: Install uv
        uses: astral-sh/setup-uv@v3
        with:
          enable-cache: true
          version: ${{ env.UV_VERSION }}
          cache-dependency-glob: "**/requirements**.txt"

      - name: Install Python and Dependencies
        run: | 
          uv python install ${{ env.PYTHON_VERSION }}
          uv tool install ruff
          uv tool install pytest
      
      - name: Run Ruff Lint
        run: |
          uv run ruff check
      
      # Login to Azure Portal Using Service Principal
      - name: Azure Login action
        uses: azure/login@v2
        with:
          creds: ${{ secrets.AZURE_DEV_CREDENTIALS }}

      # Download the Databricks CLI.
      - uses: databricks/setup-cli@main


      # validate bundle
      - run: databricks bundle validate
        working-directory: .
        env:
          DATABRICKS_BUNDLE_ENV: ${{ env.ENV}}
          BUNDLE_VAR_ADB_HOST_URL: ${{ vars.ADB_HOST_URL }}
          BUNDLE_VAR_FILE_LANDING_URL: ${{ vars.FILE_LANDING_URL }}
